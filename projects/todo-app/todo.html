<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>To-do List | Andri</title>
  <link rel="stylesheet" href="todo.css" />
</head>
<body>
  <div class="page-shell">
    <header class="app-header">
      <a href="/" class="back-link">‚Üê Kembali ke Portofolio</a>
      <div>
        <p class="app-kicker">Mini Project ‚Ä¢ Web App</p>
        <h1>To-do List Andri</h1>
        <p class="app-subtitle">
          Catat tugas harian, kelompokkan berdasarkan kategori, atur deadline, dan pantau progres. 
          Semua data disimpan di browser kamu (localStorage).
        </p>
      </div>
    </header>

    <main>
      <section class="todo-card">
        <header class="todo-header">
          <div>
            <h2>Daftar Tugas</h2>
            <p class="todo-counter">
              <span class="todo-count">0</span> tugas tersisa
            </p>
          </div>
          <div class="progress-shell">
            <div class="progress-label">
              <span class="progress-text">0 / 0 selesai</span>
            </div>
            <div class="progress-bar">
              <div class="progress-bar-fill"></div>
            </div>
          </div>
        </header>

        <form class="todo-form">
          <div class="todo-input-group">
            <input
              type="text"
              class="todo-input"
              placeholder="Tulis tugasmu di sini..."
              autocomplete="off"
            />
            <select class="todo-select">
              <option value="Umum">Umum</option>
              <option value="Kuliah">Kuliah</option>
              <option value="Kerja">Kerja</option>
              <option value="Pribadi">Pribadi</option>
            </select>
            <input type="date" class="todo-date" />
          </div>
          <button type="submit" class="btn-add">Tambah</button>
        </form>

        <div class="todo-toolbar">
          <div class="filters">
            <button type="button" class="filter-btn is-active" data-filter="all">Semua</button>
            <button type="button" class="filter-btn" data-filter="active">Aktif</button>
            <button type="button" class="filter-btn" data-filter="done">Selesai</button>
          </div>
          <div class="toolbar-actions">
            <button type="button" class="todo-clear-done">Hapus yang selesai</button>
            <button type="button" class="todo-clear-all">Hapus semua</button>
          </div>
        </div>

        <ul class="todo-list">
          <!-- item akan di-render via JS -->
        </ul>
      </section>

      <p class="small-note">
        üí° Tip: To-do List ini disimpan di <strong>localStorage</strong>, jadi tidak hilang walaupun halaman
        di-refresh (selama kamu pakai browser & device yang sama).
      </p>
    </main>
  </div>

  <script>
    const form = document.querySelector(".todo-form");
    const input = document.querySelector(".todo-input");
    const categorySelect = document.querySelector(".todo-select");
    const dateInput = document.querySelector(".todo-date");
    const listEl = document.querySelector(".todo-list");
    const countEl = document.querySelector(".todo-count");
    const filterButtons = document.querySelectorAll(".filter-btn");
    const clearDoneBtn = document.querySelector(".todo-clear-done");
    const clearAllBtn = document.querySelector(".todo-clear-all");
    const progressFill = document.querySelector(".progress-bar-fill");
    const progressText = document.querySelector(".progress-text");

    let todos = [];
    let currentFilter = "all";

    // ----- LocalStorage -----
    function loadTodos() {
      const raw = localStorage.getItem("andri-todos");
      if (!raw) return;
      try {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) {
          todos = parsed;
        }
      } catch (e) {
        console.error("Gagal parse todos:", e);
      }
    }

    function saveTodos() {
      localStorage.setItem("andri-todos", JSON.stringify(todos));
    }

    // ----- Helper -----
    function formatDate(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr);
      if (Number.isNaN(d.getTime())) return "";
      return d.toLocaleDateString("id-ID", {
        day: "2-digit",
        month: "short",
        year: "numeric",
      });
    }

    function getFilteredTodos() {
      if (currentFilter === "active") {
        return todos.filter((t) => !t.done);
      }
      if (currentFilter === "done") {
        return todos.filter((t) => t.done);
      }
      return todos;
    }

    function updateProgress() {
      const total = todos.length;
      const done = todos.filter((t) => t.done).length;
      const percent = total ? Math.round((done / total) * 100) : 0;

      progressFill.style.width = percent + "%";
      progressText.textContent = `${done} / ${total} selesai`;
    }

    // ----- Render -----
    function render() {
      const filtered = getFilteredTodos();
      listEl.innerHTML = "";

      if (filtered.length === 0) {
        const empty = document.createElement("li");
        empty.className = "todo-empty";
        empty.textContent = "Belum ada tugas. Tambah satu di atas ‚úçÔ∏è";
        listEl.appendChild(empty);
      } else {
        for (const todo of filtered) {
          const li = document.createElement("li");
          li.className = "todo-item";
          if (todo.done) li.classList.add("is-done");
          li.dataset.id = todo.id;

          const deadlineLabel = todo.deadline
            ? `<span class="pill pill-deadline">Deadline: ${formatDate(todo.deadline)}</span>`
            : "";

          li.innerHTML = `
            <label class="todo-main">
              <input type="checkbox" class="todo-checkbox" ${todo.done ? "checked" : ""} />
              <div class="todo-content">
                <span class="todo-text">${todo.text}</span>
                <div class="todo-meta">
                  <span class="pill pill-category">${todo.category || "Umum"}</span>
                  ${deadlineLabel}
                </div>
              </div>
            </label>
            <button type="button" class="todo-delete">‚úï</button>
          `;

          listEl.appendChild(li);
        }
      }

      const remaining = todos.filter((t) => !t.done).length;
      countEl.textContent = remaining;
      updateProgress();
    }

    // ----- Event: tambah todo -----
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const value = input.value.trim();
      if (!value) return;

      const category = categorySelect.value || "Umum";
      const deadline = dateInput.value || "";

      todos.push({
        id: Date.now().toString(),
        text: value,
        done: false,
        category,
        deadline,
      });

      input.value = "";
      dateInput.value = "";
      saveTodos();
      render();
    });

    // ----- Event: checkbox & delete -----
    listEl.addEventListener("click", (e) => {
      const li = e.target.closest(".todo-item");
      if (!li) return;
      const id = li.dataset.id;

      if (e.target.matches(".todo-checkbox")) {
        const todo = todos.find((t) => t.id === id);
        if (!todo) return;
        todo.done = e.target.checked;
        saveTodos();
        render();
      }

      if (e.target.matches(".todo-delete")) {
        todos = todos.filter((t) => t.id !== id);
        saveTodos();
        render();
      }
    });

    // ----- Filter buttons -----
    filterButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        filterButtons.forEach((b) => b.classList.remove("is-active"));
        btn.classList.add("is-active");
        currentFilter = btn.dataset.filter;
        render();
      });
    });

    // ----- Clear completed -----
    clearDoneBtn.addEventListener("click", () => {
      const hasDone = todos.some((t) => t.done);
      if (!hasDone) return;
      const ok = confirm("Yakin hapus semua tugas yang sudah selesai?");
      if (!ok) return;

      todos = todos.filter((t) => !t.done);
      saveTodos();
      render();
    });

    // ----- Clear all -----
    clearAllBtn.addEventListener("click", () => {
      if (!todos.length) return;
      const ok = confirm("Yakin hapus SEMUA tugas? Tindakan ini tidak bisa dibatalkan.");
      if (!ok) return;

      todos = [];
      saveTodos();
      render();
    });

    // ----- Init -----
    loadTodos();
    render();
  </script>
</body>
</html>
